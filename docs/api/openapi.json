{
  "openapi": "3.1.0",
  "info": {
    "title": "DorkOS API",
    "version": "0.2.0",
    "description": "REST/SSE API for Claude Code sessions, built with the Claude Agent SDK."
  },
  "servers": [
    {
      "url": "http://localhost:6942"
    }
  ],
  "components": {
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "version": {
            "type": "string"
          },
          "uptime": {
            "type": "number"
          },
          "tunnel": {
            "$ref": "#/components/schemas/TunnelStatus"
          }
        },
        "required": [
          "status",
          "version",
          "uptime"
        ]
      },
      "TunnelStatus": {
        "type": "object",
        "properties": {
          "connected": {
            "type": "boolean"
          },
          "url": {
            "type": [
              "string",
              "null"
            ]
          },
          "port": {
            "type": [
              "integer",
              "null"
            ]
          },
          "startedAt": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "required": [
          "connected",
          "url",
          "port",
          "startedAt"
        ]
      },
      "Session": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "lastMessagePreview": {
            "type": "string"
          },
          "permissionMode": {
            "$ref": "#/components/schemas/PermissionMode"
          },
          "model": {
            "type": "string"
          },
          "contextTokens": {
            "type": "integer"
          },
          "cwd": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "title",
          "createdAt",
          "updatedAt",
          "permissionMode"
        ]
      },
      "PermissionMode": {
        "type": "string",
        "enum": [
          "default",
          "plan",
          "acceptEdits",
          "bypassPermissions"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          },
          "details": {}
        },
        "required": [
          "error"
        ]
      },
      "CreateSessionRequest": {
        "type": "object",
        "properties": {
          "permissionMode": {
            "$ref": "#/components/schemas/PermissionMode"
          },
          "cwd": {
            "type": "string"
          }
        }
      },
      "HistoryMessage": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "user",
              "assistant"
            ]
          },
          "content": {
            "type": "string"
          },
          "toolCalls": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/HistoryToolCall"
            }
          },
          "parts": {
            "type": "array",
            "items": {
              "oneOf": [
                {
                  "$ref": "#/components/schemas/TextPart"
                },
                {
                  "$ref": "#/components/schemas/ToolCallPart"
                }
              ],
              "discriminator": {
                "propertyName": "type",
                "mapping": {
                  "text": "#/components/schemas/TextPart",
                  "tool_call": "#/components/schemas/ToolCallPart"
                }
              }
            }
          },
          "timestamp": {
            "type": "string"
          },
          "messageType": {
            "$ref": "#/components/schemas/MessageType"
          },
          "commandName": {
            "type": "string"
          },
          "commandArgs": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "role",
          "content"
        ]
      },
      "HistoryToolCall": {
        "type": "object",
        "properties": {
          "toolCallId": {
            "type": "string"
          },
          "toolName": {
            "type": "string"
          },
          "input": {
            "type": "string"
          },
          "result": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "complete"
            ]
          },
          "questions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/QuestionItem"
            }
          },
          "answers": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          }
        },
        "required": [
          "toolCallId",
          "toolName",
          "status"
        ]
      },
      "QuestionItem": {
        "type": "object",
        "properties": {
          "header": {
            "type": "string"
          },
          "question": {
            "type": "string"
          },
          "options": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/QuestionOption"
            }
          },
          "multiSelect": {
            "type": "boolean"
          }
        },
        "required": [
          "header",
          "question",
          "options",
          "multiSelect"
        ]
      },
      "QuestionOption": {
        "type": "object",
        "properties": {
          "label": {
            "type": "string"
          },
          "description": {
            "type": "string"
          }
        },
        "required": [
          "label"
        ]
      },
      "TextPart": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "text"
            ]
          },
          "text": {
            "type": "string"
          }
        },
        "required": [
          "type",
          "text"
        ]
      },
      "ToolCallPart": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "tool_call"
            ]
          },
          "toolCallId": {
            "type": "string"
          },
          "toolName": {
            "type": "string"
          },
          "input": {
            "type": "string"
          },
          "result": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "running",
              "complete",
              "error"
            ]
          },
          "interactiveType": {
            "type": "string",
            "enum": [
              "approval",
              "question"
            ]
          },
          "questions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/QuestionItem"
            }
          },
          "answers": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          }
        },
        "required": [
          "type",
          "toolCallId",
          "toolName",
          "status"
        ]
      },
      "MessageType": {
        "type": "string",
        "enum": [
          "command",
          "compaction"
        ]
      },
      "TaskItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "subject": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "activeForm": {
            "type": "string"
          },
          "status": {
            "$ref": "#/components/schemas/TaskStatus"
          },
          "blockedBy": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "blocks": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "owner": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "subject",
          "status"
        ]
      },
      "TaskStatus": {
        "type": "string",
        "enum": [
          "pending",
          "in_progress",
          "completed"
        ]
      },
      "UpdateSessionRequest": {
        "type": "object",
        "properties": {
          "permissionMode": {
            "$ref": "#/components/schemas/PermissionMode"
          },
          "model": {
            "type": "string"
          }
        }
      },
      "SendMessageRequest": {
        "type": "object",
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1
          },
          "cwd": {
            "type": "string"
          }
        },
        "required": [
          "content"
        ]
      },
      "ApprovalRequest": {
        "type": "object",
        "properties": {
          "toolCallId": {
            "type": "string"
          }
        },
        "required": [
          "toolCallId"
        ]
      },
      "SubmitAnswersRequest": {
        "type": "object",
        "properties": {
          "toolCallId": {
            "type": "string"
          },
          "answers": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          }
        },
        "required": [
          "toolCallId",
          "answers"
        ]
      },
      "BrowseDirectoryResponse": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string"
          },
          "entries": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/DirectoryEntry"
            }
          },
          "parent": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "required": [
          "path",
          "entries",
          "parent"
        ]
      },
      "DirectoryEntry": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "path": {
            "type": "string"
          },
          "isDirectory": {
            "type": "boolean"
          }
        },
        "required": [
          "name",
          "path",
          "isDirectory"
        ]
      },
      "CommandRegistry": {
        "type": "object",
        "properties": {
          "commands": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CommandEntry"
            }
          },
          "lastScanned": {
            "type": "string"
          }
        },
        "required": [
          "commands",
          "lastScanned"
        ]
      },
      "CommandEntry": {
        "type": "object",
        "properties": {
          "namespace": {
            "type": "string"
          },
          "command": {
            "type": "string"
          },
          "fullCommand": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "argumentHint": {
            "type": "string"
          },
          "allowedTools": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "filePath": {
            "type": "string"
          }
        },
        "required": [
          "namespace",
          "command",
          "fullCommand",
          "description",
          "filePath"
        ]
      }
    },
    "parameters": {}
  },
  "paths": {
    "/api/health": {
      "get": {
        "tags": [
          "Health"
        ],
        "summary": "Health check",
        "responses": {
          "200": {
            "description": "Server is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/sessions": {
      "post": {
        "tags": [
          "Sessions"
        ],
        "summary": "Create a new session",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateSessionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Created session",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Session"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Sessions"
        ],
        "summary": "List all sessions",
        "parameters": [
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 500,
              "default": 200
            },
            "required": false,
            "name": "limit",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "cwd",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Array of sessions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Session"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/sessions/{id}": {
      "get": {
        "tags": [
          "Sessions"
        ],
        "summary": "Get session details",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Session details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Session"
                }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": [
          "Sessions"
        ],
        "summary": "Update session settings",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateSessionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated session",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Session"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/sessions/{id}/messages": {
      "get": {
        "tags": [
          "Sessions"
        ],
        "summary": "Get message history",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Message history",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "messages": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/HistoryMessage"
                      }
                    }
                  },
                  "required": [
                    "messages"
                  ]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Sessions"
        ],
        "summary": "Send message (SSE stream response)",
        "description": "Sends a message to the Claude agent and streams the response as Server-Sent Events. Event types: text_delta, tool_call_start, tool_call_delta, tool_call_end, tool_result, approval_required, question_prompt, error, done, session_status, task_update. Each SSE message has the format: `event: message\\ndata: {\"type\":\"<type>\",\"data\":{...}}\\n\\n`",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SendMessageRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "SSE stream of StreamEvent objects",
            "content": {
              "text/event-stream": {
                "schema": {
                  "type": "string",
                  "description": "Server-Sent Events stream"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/sessions/{id}/tasks": {
      "get": {
        "tags": [
          "Sessions"
        ],
        "summary": "Get task state from session transcript",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Task list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "tasks": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/TaskItem"
                      }
                    }
                  },
                  "required": [
                    "tasks"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/sessions/{id}/approve": {
      "post": {
        "tags": [
          "Sessions"
        ],
        "summary": "Approve pending tool call",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApprovalRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Approved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "ok"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "No pending approval",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/sessions/{id}/deny": {
      "post": {
        "tags": [
          "Sessions"
        ],
        "summary": "Deny pending tool call",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApprovalRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Denied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "ok"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "No pending approval",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/sessions/{id}/submit-answers": {
      "post": {
        "tags": [
          "Sessions"
        ],
        "summary": "Submit answers for AskUserQuestion",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubmitAnswersRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Answers submitted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "ok"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "No pending question",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/directory": {
      "get": {
        "tags": [
          "Directory"
        ],
        "summary": "Browse directories",
        "description": "Browse directories on the server filesystem. Restricted to the home directory for security.",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": false,
            "name": "path",
            "in": "query"
          },
          {
            "schema": {
              "type": [
                "boolean",
                "null"
              ],
              "default": false
            },
            "required": false,
            "name": "showHidden",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Directory listing",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BrowseDirectoryResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid path",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Access denied (path outside home directory)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Directory not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/directory/default": {
      "get": {
        "tags": [
          "Directory"
        ],
        "summary": "Get default working directory",
        "description": "Returns the server's default working directory (process.cwd()).",
        "responses": {
          "200": {
            "description": "Default directory path",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "path": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "path"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/commands": {
      "get": {
        "tags": [
          "Commands"
        ],
        "summary": "List all slash commands",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "enum": [
                "true",
                "false"
              ]
            },
            "required": false,
            "name": "refresh",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "cwd",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Command registry",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CommandRegistry"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}